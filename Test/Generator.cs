using System.Diagnostics;
using System.Globalization;
using System.Net;
using System.Net.Sockets;
using System.Text;
using Npgsql.Internal.TypeHandlers;

namespace Test;

public class Generator
{
    [Test]
    public void Start()
    {
        var _stopwatch = new Stopwatch();
        _stopwatch.Start();
        var client = new UdpClient();
        client.Connect(IPAddress.Loopback, 9060);
        for (int i = 0; i < 2; i++)
        {
            var msg = ToByteArray(ByTemplate(i.ToString()));
            for (int j = 0; j < 4; j++)
            {
                client.Send(msg);
            }
            
            if (i % 100 == 0)
            {
                Console.WriteLine(i);
            }
            
            Thread.Sleep(1);
        }

        _stopwatch.Stop();
        Console.WriteLine(_stopwatch.ElapsedMilliseconds);
    }

    private byte[] ToByteArray(string s)
    {
        return s
            .Split('-')
            .Select(x => byte.Parse(x, NumberStyles.HexNumber))
            .ToArray();
    }

    private string ByTemplate(string idstr)
    {
        // var hepHeader =
        //     "48-45-50-33-06-A7-00-00-00-01-00-07-02-00-00-00-02-00-07-11-00-00-00-03-00-0A-0A-E8-23-48-00-00-00-04-00-0A-0A-E8-23-49-00-00-00-07-00-08-13-C4-00-00-00-08-00-08-13-C4-00-00-00-09-00-0A-63-89-A2-94-00-00-00-0A-00-0A-00-0E-C4-08-00-00-00-0B-00-07-01-00-00-00-0C-00-0A-00-00-00-01-00-00-00-0F-06-4A-";
        // var sip =
        //         "INVITE sip:autotest1683155314t20_a_stub@10.232.35.73:5060 SIP/2.0\nVia: SIP/2.0/UDP 10.232.35.71:5060;TH=div;rport;branch=z9hG4bKPjb73c8639-a53c-472d-855c-703191adcf16\nFrom: \"78007557775\" <sip:72222222222@10.232.35.71>;tag=67dd0ab0-2920-4016-937c-c1c9173cc4ea\nTo: <sip:autotest1683155314t20_a_stub@10.232.35.73>\nContact: <sip:asterisk@10.232.35.71:5060>\nCall-ID: 908de092-e83e-4b23-80be-ea9f0d7d4680\nCSeq: 17075 INVITE\nAllow: OPTIONS, REGISTER, SUBSCRIBE, NOTIFY, PUBLISH, INVITE, ACK, BYE, CANCEL, UPDATE, PRACK, MESSAGE, REFER\nSupported: 100rel, timer, replaces, norefersub, histinfo\nSession-Expires: 600\nMin-SE: 90\nI-callDirection: outbound\nI-SegmentId: 6211680304\nI-ExternalTaskId: 073451a730ac4dca82e06b21ede85b20\nI-CallType: Pds\nI-calleeType: PhoneNumber\nI-phoneNumber: +72222222222\nI-primary_ani: 78007557775\nI-phoneType: pds\nI-ForbidRedial: False\nI-callerType: customer\nX-eduId: 6452e98f000000000ae8410e23360002\nX-ActionId: 74c8365854054ac68e7cf97b46e607c5\nI-primary_dnis: +72222222222\nI-CallId: 6211680304\nI-TCommunicationId: d976838267a54195ac213ac6f5b0f685\nI-TelephonyServiceHostName: ds-asterisk-qa-01t\nI-callerName: autotest1683155314t20\nI-queueCode: 022466\nI-dialingMode: Pds\nI-CallDirection: outbound\nX-CallToOperator: 1\nT-Communication-Id: d976838267a54195ac213ac6f5b0f685\nMax-Forwards: 70\nUser-Agent: ds-asterisk-qa-01t.ds.ast.local\nContent-Type: application/sdp\nContent-Length:   237\nTH: dih\n\nv=0\no=- 1562164403 1562164403 IN IP4 10.232.35.71\ns=Asterisk\nc=IN IP4 10.232.35.71\nt=0 0\nm=audio 16324 RTP/AVP 8 101\na=rtpmap:8 PCMA/8000\na=rtpmap:101 telephone-event/8000\na=fmtp:101 0-16\na=ptime:20\na=maxptime:150\na=sendrecv"
        //     ;
        var id = BitConverter.ToString(Encoding.UTF8.GetBytes(idstr));

        return
            $"48-45-50-33-06-A7-00-00-00-01-00-07-02-00-00-00-02-00-07-11-00-00-00-03-00-0A-0A-E8-23-48-00-00-00-04-00-0A-0A-E8-23-49-00-00-00-07-00-08-13-C4-00-00-00-08-00-08-13-C4-00-00-00-09-00-0A-63-89-A2-94-00-00-00-0A-00-0A-00-0E-C4-08-00-00-00-0B-00-07-01-00-00-00-0C-00-0A-00-00-00-01-00-00-00-0F-06-4A-49-4E-56-49-54-45-20-73-69-70-3A-76-76-67-72-65-6B-6F-76-5F-77-6F-66-40-31-30-2E-32-33-32-2E-33-35-2E-37-33-3A-35-30-36-30-20-53-49-50-2F-32-2E-30-0D-0A-56-69-61-3A-20-53-49-50-2F-32-2E-30-2F-55-44-50-20-31-30-2E-32-33-32-2E-33-35-2E-37-32-3A-35-30-36-30-3B-72-70-6F-72-74-3B-62-72-61-6E-63-68-3D-7A-39-68-47-34-62-4B-50-6A-35-61-36-36-65-37-30-39-2D-64-39-37-34-2D-34-61-64-39-2D-61-63-65-39-2D-62-36-65-36-39-61-30-30-35-31-31-38-0D-0A-46-72-6F-6D-3A-20-22-37-38-30-30-33-33-33-37-37-37-33-22-20-3C-73-69-70-3A-37-38-30-30-33-33-33-37-37-37-33-40-31-30-2E-32-33-32-2E-33-35-2E-37-32-3E-3B-74-61-67-3D-33-64-63-36-66-36-37-62-2D-66-66-66-66-2D-34-66-39-38-2D-38-33-61-64-2D-33-63-34-63-35-32-62-61-65-32-32-30-0D-0A-54-6F-3A-20-3C-73-69-70-3A-76-76-67-72-65-6B-6F-76-5F-77-6F-66-40-31-30-2E-32-33-32-2E-33-35-2E-37-33-3E-0D-0A-43-6F-6E-74-61-63-74-3A-20-3C-73-69-70-3A-61-73-74-65-72-69-73-6B-40-31-30-2E-32-33-32-2E-33-35-2E-37-32-3A-35-30-36-30-3E-0D-0A-43-61-6C-6C-2D-49-44-3A-20-{id}-0D-0A-43-53-65-71-3A-20-31-37-30-34-35-20-49-4E-56-49-54-45-0D-0A-41-6C-6C-6F-77-3A-20-4F-50-54-49-4F-4E-53-2C-20-52-45-47-49-53-54-45-52-2C-20-53-55-42-53-43-52-49-42-45-2C-20-4E-4F-54-49-46-59-2C-20-50-55-42-4C-49-53-48-2C-20-49-4E-56-49-54-45-2C-20-41-43-4B-2C-20-42-59-45-2C-20-43-41-4E-43-45-4C-2C-20-55-50-44-41-54-45-2C-20-50-52-41-43-4B-2C-20-4D-45-53-53-41-47-45-2C-20-52-45-46-45-52-0D-0A-53-75-70-70-6F-72-74-65-64-3A-20-31-30-30-72-65-6C-2C-20-74-69-6D-65-72-2C-20-72-65-70-6C-61-63-65-73-2C-20-6E-6F-72-65-66-65-72-73-75-62-2C-20-68-69-73-74-69-6E-66-6F-0D-0A-53-65-73-73-69-6F-6E-2D-45-78-70-69-72-65-73-3A-20-36-30-30-0D-0A-4D-69-6E-2D-53-45-3A-20-39-30-0D-0A-49-2D-54-65-6C-65-70-68-6F-6E-79-53-65-72-76-69-63-65-48-6F-73-74-4E-61-6D-65-3A-20-64-73-2D-61-73-74-65-72-69-73-6B-2D-71-61-2D-30-32-74-2E-64-73-2E-61-73-74-2E-6C-6F-63-61-6C-0D-0A-49-2D-63-61-6C-6C-44-69-72-65-63-74-69-6F-6E-3A-20-6F-75-74-62-6F-75-6E-64-0D-0A-49-2D-63-61-6C-6C-53-65-73-73-69-6F-6E-49-64-3A-20-34-39-65-65-32-66-34-61-64-37-38-32-34-39-65-33-39-62-61-62-32-32-37-62-30-32-66-63-64-33-38-62-0D-0A-49-2D-74-65-6C-65-70-68-6F-6E-79-43-6F-6D-6D-75-6E-69-63-61-74-69-6F-6E-49-64-3A-20-61-30-36-35-66-34-35-32-35-65-35-64-34-63-37-30-38-30-32-37-63-35-36-37-62-32-35-35-61-31-61-64-0D-0A-58-2D-65-64-75-49-64-3A-20-36-33-38-39-61-32-39-33-30-30-30-30-30-30-30-30-30-61-65-38-34-31-30-65-32-33-33-36-30-30-30-32-0D-0A-49-2D-54-43-6F-6D-6D-75-6E-69-63-61-74-69-6F-6E-49-64-3A-20-61-30-36-35-66-34-35-32-35-65-35-64-34-63-37-30-38-30-32-37-63-35-36-37-62-32-35-35-61-31-61-64-0D-0A-49-2D-45-78-74-65-72-6E-61-6C-54-61-73-6B-49-64-3A-20-34-39-65-65-32-66-34-61-64-37-38-32-34-39-65-33-39-62-61-62-32-32-37-62-30-32-66-63-64-33-38-62-0D-0A-49-2D-43-61-6C-6C-54-79-70-65-3A-20-55-73-65-72-54-6F-43-75-73-74-6F-6D-65-72-0D-0A-49-2D-46-6F-72-62-69-64-52-65-64-69-61-6C-3A-20-46-61-6C-73-65-0D-0A-49-2D-70-68-6F-6E-65-4E-75-6D-62-65-72-3A-20-2B-37-39-30-34-32-32-30-39-36-30-36-0D-0A-49-2D-43-61-6C-6C-49-64-3A-20-35-32-38-37-38-32-36-37-30-37-0D-0A-49-2D-64-69-61-6C-69-6E-67-4D-6F-64-65-3A-20-4D-61-6E-75-61-6C-0D-0A-49-2D-43-61-6C-6C-44-69-72-65-63-74-69-6F-6E-3A-20-6F-75-74-62-6F-75-6E-64-0D-0A-54-2D-43-6F-6D-6D-75-6E-69-63-61-74-69-6F-6E-2D-49-64-3A-20-61-30-36-35-66-34-35-32-35-65-35-64-34-63-37-30-38-30-32-37-63-35-36-37-62-32-35-35-61-31-61-64-0D-0A-49-2D-63-61-6C-6C-65-65-54-79-70-65-3A-20-50-68-6F-6E-65-4E-75-6D-62-65-72-0D-0A-58-2D-41-63-74-69-6F-6E-49-64-3A-20-31-36-36-39-39-36-34-34-32-36-37-30-33-30-30-37-39-36-38-33-31-38-2D-30-30-30-30-30-30-30-30-30-0D-0A-58-2D-43-61-6C-6C-53-63-65-6E-61-72-69-6F-3A-20-55-73-65-72-54-6F-43-75-73-74-6F-6D-65-72-0D-0A-4D-61-78-2D-46-6F-72-77-61-72-64-73-3A-20-37-30-0D-0A-55-73-65-72-2D-41-67-65-6E-74-3A-20-64-73-2D-61-73-74-65-72-69-73-6B-2D-71-61-2D-30-32-74-2E-64-73-2E-61-73-74-2E-6C-6F-63-61-6C-0D-0A-43-6F-6E-74-65-6E-74-2D-54-79-70-65-3A-20-61-70-70-6C-69-63-61-74-69-6F-6E-2F-73-64-70-0D-0A-43-6F-6E-74-65-6E-74-2D-4C-65-6E-67-74-68-3A-20-20-20-32-33-35-0D-0A-0D-0A-76-3D-30-0D-0A-6F-3D-2D-20-33-34-35-32-36-37-31-38-35-20-33-34-35-32-36-37-31-38-35-20-49-4E-20-49-50-34-20-31-30-2E-32-33-32-2E-33-35-2E-37-32-0D-0A-73-3D-41-73-74-65-72-69-73-6B-0D-0A-63-3D-49-4E-20-49-50-34-20-31-30-2E-32-33-32-2E-33-35-2E-37-32-0D-0A-74-3D-30-20-30-0D-0A-6D-3D-61-75-64-69-6F-20-35-36-31-38-32-20-52-54-50-2F-41-56-50-20-38-20-31-30-31-0D-0A-61-3D-72-74-70-6D-61-70-3A-38-20-50-43-4D-41-2F-38-30-30-30-0D-0A-61-3D-72-74-70-6D-61-70-3A-31-30-31-20-74-65-6C-65-70-68-6F-6E-65-2D-65-76-65-6E-74-2F-38-30-30-30-0D-0A-61-3D-66-6D-74-70-3A-31-30-31-20-30-2D-31-36-0D-0A-61-3D-70-74-69-6D-65-3A-32-30-0D-0A-61-3D-6D-61-78-70-74-69-6D-65-3A-31-35-30-0D-0A-61-3D-73-65-6E-64-72-65-63-76-0D-0A";
    }
}